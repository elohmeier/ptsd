p@{ config, lib, pkgs, ... }:

{
  programs.fish = {
    enable = true;
    useBabelfish = true;

    shellAliases = {
      gaapf = "git add . && git commit --amend --no-edit && git push --force";
      gapf = "git commit --amend --no-edit && git push --force";
      grep = "grep --color";
      l = "exa -al";
      la = "exa -al";
      lg = "exa -al --git";
      ll = "exa -l";
      ls = "exa";
      ping6 = lib.mkIf pkgs.stdenv.isLinux "ping -6";
      slvpn-set-dns = "sudo busctl call org.freedesktop.resolve1 /org/freedesktop/resolve1 org.freedesktop.resolve1.Manager SetLinkDNS 'ia(iay)' (ip -j link show dev tun0 | jq '.[0].ifindex') 1 2 4 172 16 0 1 && resolvectl status tun0";
      telnet = "screen //telnet";
      tree = "exa --tree";
      vi = "nvim";
      vim = "nvim";
      nbconvert = "jupyter nbconvert --to script --stdout";
    };

    shellAbbrs = {
      "cd.." = "cd ..";
      "ga." = "git add .";
      br = "broot";
      etm = "et -c \"tmux -CC new -A -s main\"";
      ga = "git add";
      gc = "git commit";
      gcf = "git commit --fixup";
      gco = "git checkout";
      gcp = "git cherry-pick";
      gd = "git diff";
      gf = "git fetch";
      gl = "git log";
      gp = "git pull";
      gpp = "git push";
      gs = "git status";
      kc = "kubectl";
    };

    interactiveShellInit = ''
      set -U fish_greeting
      source ${../../4scripts/iterm2-integration.fish}
      fzf_configure_bindings --directory=\ct
    '';
    # + lib.optionalString config.wayland.windowManager.sway.enable ''
    #   if status is-login
    #     if test -z "$DISPLAY" -a "$XDG_VTNR" = 1
    #       # pass sway log output to journald
    #       exec ${pkgs.systemd}/bin/systemd-cat --identifier=sway ${pkgs.sway}/bin/sway --unsupported-gpu
    #     end
    #   end
    # '';

    plugins = with pkgs.fishPlugins; [
      #{ name = "done"; src = done.src; } # disabled, now solved via iterm2 integration
      { name = "fzf"; inherit (fzf-fish) src; }
    ];
  };

  programs.zoxide.enable = true;

  programs.direnv.enable = true;
  programs.direnv.nix-direnv.enable = true;

  home.packages = with pkgs; [ exa ];

  home.file.".config/fish/functions".source = if (builtins.hasAttr "nixosConfig" p) then ../../src/fish else config.lib.file.mkOutOfStoreSymlink "${config.home.homeDirectory}/repos/ptsd/src/fish";

  # vivid generate ayu
  home.sessionVariables.LS_COLORS = "*~=0;38;2;170;170;170:mh=0:di=0;38;2;27;125;196:pi=0;38;2;0;0;0;48;2;27;125;196:mi=0;38;2;0;0;0;48;2;237;102;106:su=0:or=0;38;2;0;0;0;48;2;237;102;106:sg=0:st=0:ln=0;38;2;240;113;113:ow=0:cd=0;38;2;0;0;0;48;2;134;179;0:no=0:ca=0:fi=0:rs=0:tw=0:bd=0;38;2;0;0;0;48;2;237;102;106:so=0;38;2;0;0;0;48;2;240;113;113:ex=1;38;2;237;102;106:do=0;38;2;0;0;0;48;2;240;113;113:*.h=0;38;2;49;136;102:*.c=0;38;2;49;136;102:*.a=1;38;2;237;102;106:*.o=0;38;2;170;170;170:*.d=0;38;2;49;136;102:*.r=0;38;2;49;136;102:*.p=0;38;2;49;136;102:*.t=0;38;2;49;136;102:*.m=0;38;2;49;136;102:*.z=4;38;2;134;179;0:*.ll=0;38;2;49;136;102:*.xz=4;38;2;134;179;0:*.hs=0;38;2;49;136;102:*.gv=0;38;2;49;136;102:*.sh=0;38;2;49;136;102:*.rb=0;38;2;49;136;102:*.gz=4;38;2;134;179;0:*.la=0;38;2;170;170;170:*.bc=0;38;2;170;170;170:*.hh=0;38;2;49;136;102:*.jl=0;38;2;49;136;102:*.cr=0;38;2;49;136;102:*.di=0;38;2;49;136;102:*.rm=0;38;2;240;113;113:*.md=0;38;2;237;147;102:*.wv=0;38;2;240;113;113:*.as=0;38;2;49;136;102:*.hi=0;38;2;170;170;170:*.bz=4;38;2;134;179;0:*.so=1;38;2;237;102;106:*.ex=0;38;2;49;136;102:*.ts=0;38;2;49;136;102:*.cp=0;38;2;49;136;102:*css=0;38;2;49;136;102:*.td=0;38;2;49;136;102:*.vb=0;38;2;49;136;102:*.rs=0;38;2;49;136;102:*.7z=4;38;2;134;179;0:*.go=0;38;2;49;136;102:*.ml=0;38;2;49;136;102:*.py=0;38;2;49;136;102:*.nb=0;38;2;49;136;102:*.cs=0;38;2;49;136;102:*.ps=0;38;2;237;102;106:*.el=0;38;2;49;136;102:*.mn=0;38;2;49;136;102:*.pl=0;38;2;49;136;102:*.kt=0;38;2;49;136;102:*.lo=0;38;2;170;170;170:*.ko=1;38;2;237;102;106:*.cc=0;38;2;49;136;102:*.pm=0;38;2;49;136;102:*.ui=0;38;2;237;147;102:*.js=0;38;2;49;136;102:*.fs=0;38;2;49;136;102:*.pp=0;38;2;49;136;102:*.vcd=4;38;2;134;179;0:*.m4v=0;38;2;240;113;113:*.mpg=0;38;2;240;113;113:*.hpp=0;38;2;49;136;102:*.bbl=0;38;2;170;170;170:*.h++=0;38;2;49;136;102:*.zip=4;38;2;134;179;0:*.bmp=0;38;2;240;113;113:*.xmp=0;38;2;237;147;102:*.txt=0;38;2;237;147;102:*.deb=4;38;2;134;179;0:*.pyd=0;38;2;170;170;170:*.inl=0;38;2;49;136;102:*.mkv=0;38;2;240;113;113:*.wmv=0;38;2;240;113;113:*.aux=0;38;2;170;170;170:*.mp3=0;38;2;240;113;113:*.exe=1;38;2;237;102;106:*.sbt=0;38;2;49;136;102:*.ico=0;38;2;240;113;113:*.odt=0;38;2;237;102;106:*.php=0;38;2;49;136;102:*.ini=0;38;2;237;147;102:*.psd=0;38;2;240;113;113:*.pyo=0;38;2;170;170;170:*.pyc=0;38;2;170;170;170:*.rtf=0;38;2;237;102;106:*.xlr=0;38;2;237;102;106:*.mov=0;38;2;240;113;113:*.bib=0;38;2;237;147;102:*.vob=0;38;2;240;113;113:*.iso=4;38;2;134;179;0:*.img=4;38;2;134;179;0:*.erl=0;38;2;49;136;102:*.fsx=0;38;2;49;136;102:*.rpm=4;38;2;134;179;0:*.toc=0;38;2;170;170;170:*.pkg=4;38;2;134;179;0:*.clj=0;38;2;49;136;102:*.pps=0;38;2;237;102;106:*.xls=0;38;2;237;102;106:*.dmg=4;38;2;134;179;0:*.tml=0;38;2;237;147;102:*.ogg=0;38;2;240;113;113:*.mid=0;38;2;240;113;113:*.pid=0;38;2;170;170;170:*.doc=0;38;2;237;102;106:*.nix=0;38;2;237;147;102:*.jar=4;38;2;134;179;0:*.aif=0;38;2;240;113;113:*.pas=0;38;2;49;136;102:*.bin=4;38;2;134;179;0:*.fnt=0;38;2;240;113;113:*.csx=0;38;2;49;136;102:*.cfg=0;38;2;237;147;102:*.inc=0;38;2;49;136;102:*.svg=0;38;2;240;113;113:*.fsi=0;38;2;49;136;102:*.kts=0;38;2;49;136;102:*.odp=0;38;2;237;102;106:*.tgz=4;38;2;134;179;0:*.zsh=0;38;2;49;136;102:*.wav=0;38;2;240;113;113:*.ps1=0;38;2;49;136;102:*.rst=0;38;2;237;147;102:*.com=1;38;2;237;102;106:*.pgm=0;38;2;240;113;113:*.dox=0;38;2;154;232;69:*.tif=0;38;2;240;113;113:*.fls=0;38;2;170;170;170:*.otf=0;38;2;240;113;113:*.pbm=0;38;2;240;113;113:*.dpr=0;38;2;49;136;102:*.ppm=0;38;2;240;113;113:*.bz2=4;38;2;134;179;0:*.tex=0;38;2;49;136;102:*.dot=0;38;2;49;136;102:*.blg=0;38;2;170;170;170:*.xml=0;38;2;237;147;102:*.ods=0;38;2;237;102;106:*.avi=0;38;2;240;113;113:*.idx=0;38;2;170;170;170:*.htc=0;38;2;49;136;102:*.ttf=0;38;2;240;113;113:*.tar=4;38;2;134;179;0:*.csv=0;38;2;237;147;102:*.bat=1;38;2;237;102;106:*.gif=0;38;2;240;113;113:*.tsx=0;38;2;49;136;102:*.mir=0;38;2;49;136;102:*.c++=0;38;2;49;136;102:*.lua=0;38;2;49;136;102:*.swp=0;38;2;170;170;170:*.def=0;38;2;49;136;102:*.cgi=0;38;2;49;136;102:*.ppt=0;38;2;237;102;106:*hgrc=0;38;2;154;232;69:*.dll=1;38;2;237;102;106:*.git=0;38;2;170;170;170:*.epp=0;38;2;49;136;102:*.tmp=0;38;2;170;170;170:*.vim=0;38;2;49;136;102:*.png=0;38;2;240;113;113:*.ics=0;38;2;237;102;106:*.sty=0;38;2;170;170;170:*.mp4=0;38;2;240;113;113:*.xcf=0;38;2;240;113;113:*.bag=4;38;2;134;179;0:*.bst=0;38;2;237;147;102:*.gvy=0;38;2;49;136;102:*.pod=0;38;2;49;136;102:*.pro=0;38;2;154;232;69:*.elm=0;38;2;49;136;102:*.ipp=0;38;2;49;136;102:*.exs=0;38;2;49;136;102:*.bsh=0;38;2;49;136;102:*.out=0;38;2;170;170;170:*.flv=0;38;2;240;113;113:*.jpg=0;38;2;240;113;113:*.ind=0;38;2;170;170;170:*.hxx=0;38;2;49;136;102:*.pdf=0;38;2;237;102;106:*.ltx=0;38;2;49;136;102:*.bak=0;38;2;170;170;170:*.mli=0;38;2;49;136;102:*.sxi=0;38;2;237;102;106:*.wma=0;38;2;240;113;113:*.fon=0;38;2;240;113;113:*.awk=0;38;2;49;136;102:*.sql=0;38;2;49;136;102:*.cxx=0;38;2;49;136;102:*.m4a=0;38;2;240;113;113:*.sxw=0;38;2;237;102;106:*.apk=4;38;2;134;179;0:*.htm=0;38;2;237;147;102:*.eps=0;38;2;240;113;113:*.cpp=0;38;2;49;136;102:*.rar=4;38;2;134;179;0:*.ilg=0;38;2;170;170;170:*.kex=0;38;2;237;102;106:*.bcf=0;38;2;170;170;170:*.swf=0;38;2;240;113;113:*.yml=0;38;2;237;147;102:*.arj=4;38;2;134;179;0:*.tcl=0;38;2;49;136;102:*.tbz=4;38;2;134;179;0:*TODO=1:*.zst=4;38;2;134;179;0:*.asa=0;38;2;49;136;102:*.log=0;38;2;170;170;170:*.flac=0;38;2;240;113;113:*.tiff=0;38;2;240;113;113:*.opus=0;38;2;240;113;113:*.lock=0;38;2;170;170;170:*.xlsx=0;38;2;237;102;106:*.webm=0;38;2;240;113;113:*.hgrc=0;38;2;154;232;69:*.mpeg=0;38;2;240;113;113:*.toml=0;38;2;237;147;102:*.html=0;38;2;237;147;102:*.less=0;38;2;49;136;102:*.yaml=0;38;2;237;147;102:*.psd1=0;38;2;49;136;102:*.pptx=0;38;2;237;102;106:*.json=0;38;2;237;147;102:*.psm1=0;38;2;49;136;102:*.dart=0;38;2;49;136;102:*.h264=0;38;2;240;113;113:*.purs=0;38;2;49;136;102:*.fish=0;38;2;49;136;102:*.lisp=0;38;2;49;136;102:*.rlib=0;38;2;170;170;170:*.make=0;38;2;154;232;69:*.orig=0;38;2;170;170;170:*.jpeg=0;38;2;240;113;113:*.java=0;38;2;49;136;102:*.epub=0;38;2;237;102;106:*.tbz2=4;38;2;134;179;0:*.docx=0;38;2;237;102;106:*.bash=0;38;2;49;136;102:*.conf=0;38;2;237;147;102:*.diff=0;38;2;49;136;102:*.scala=0;38;2;49;136;102:*.dyn_o=0;38;2;170;170;170:*.cache=0;38;2;170;170;170:*.cabal=0;38;2;49;136;102:*.ipynb=0;38;2;49;136;102:*.xhtml=0;38;2;237;147;102:*passwd=0;38;2;237;147;102:*.shtml=0;38;2;237;147;102:*.mdown=0;38;2;237;147;102:*.patch=0;38;2;49;136;102:*.swift=0;38;2;49;136;102:*shadow=0;38;2;237;147;102:*.cmake=0;38;2;154;232;69:*.toast=4;38;2;134;179;0:*.class=0;38;2;170;170;170:*README=0;38;2;0;0;0;48;2;237;147;102:*LICENSE=0;38;2;102;102;102:*.matlab=0;38;2;49;136;102:*TODO.md=1:*.flake8=0;38;2;154;232;69:*COPYING=0;38;2;102;102;102:*.gradle=0;38;2;49;136;102:*.ignore=0;38;2;154;232;69:*.config=0;38;2;237;147;102:*INSTALL=0;38;2;0;0;0;48;2;237;147;102:*.groovy=0;38;2;49;136;102:*.dyn_hi=0;38;2;170;170;170:*.desktop=0;38;2;237;147;102:*Makefile=0;38;2;154;232;69:*.gemspec=0;38;2;154;232;69:*TODO.txt=1:*setup.py=0;38;2;154;232;69:*Doxyfile=0;38;2;154;232;69:*configure=0;38;2;154;232;69:*.rgignore=0;38;2;154;232;69:*.markdown=0;38;2;237;147;102:*.kdevelop=0;38;2;154;232;69:*COPYRIGHT=0;38;2;102;102;102:*.fdignore=0;38;2;154;232;69:*.DS_Store=0;38;2;170;170;170:*README.md=0;38;2;0;0;0;48;2;237;147;102:*.cmake.in=0;38;2;154;232;69:*README.txt=0;38;2;0;0;0;48;2;237;147;102:*SConscript=0;38;2;154;232;69:*.localized=0;38;2;170;170;170:*Dockerfile=0;38;2;237;147;102:*.scons_opt=0;38;2;170;170;170:*CODEOWNERS=0;38;2;154;232;69:*INSTALL.md=0;38;2;0;0;0;48;2;237;147;102:*.gitconfig=0;38;2;154;232;69:*SConstruct=0;38;2;154;232;69:*.gitignore=0;38;2;154;232;69:*MANIFEST.in=0;38;2;154;232;69:*.gitmodules=0;38;2;154;232;69:*Makefile.in=0;38;2;170;170;170:*INSTALL.txt=0;38;2;0;0;0;48;2;237;147;102:*Makefile.am=0;38;2;154;232;69:*.synctex.gz=0;38;2;170;170;170:*.travis.yml=0;38;2;49;136;102:*LICENSE-MIT=0;38;2;102;102;102:*configure.ac=0;38;2;154;232;69:*appveyor.yml=0;38;2;49;136;102:*.fdb_latexmk=0;38;2;170;170;170:*.applescript=0;38;2;49;136;102:*CONTRIBUTORS=0;38;2;0;0;0;48;2;237;147;102:*.clang-format=0;38;2;154;232;69:*CMakeCache.txt=0;38;2;170;170;170:*.gitattributes=0;38;2;154;232;69:*LICENSE-APACHE=0;38;2;102;102;102:*CMakeLists.txt=0;38;2;154;232;69:*CONTRIBUTORS.md=0;38;2;0;0;0;48;2;237;147;102:*CONTRIBUTORS.txt=0;38;2;0;0;0;48;2;237;147;102:*requirements.txt=0;38;2;154;232;69:*.sconsign.dblite=0;38;2;170;170;170:*package-lock.json=0;38;2;170;170;170:*.CFUserTextEncoding=0;38;2;170;170;170";
}
